import{_ as p,I as i,c as e,o as h,a3 as t,J as a}from"./chunks/framework.xghCY4x5.js";const u=JSON.parse('{"title":"权限系统使用说明","description":"","frontmatter":{},"headers":[],"relativePath":"docs/development/architecture/PERMISSION_SYSTEM.md","filePath":"docs/development/architecture/PERMISSION_SYSTEM.md","lastUpdated":1756555974000}'),k={name:"docs/development/architecture/PERMISSION_SYSTEM.md"};function r(d,s,E,g,o,c){const n=i("NolebaseGitContributors"),l=i("NolebaseGitChangelog");return h(),e("div",null,[s[0]||(s[0]=t(`<h1 id="权限系统使用说明" tabindex="-1">权限系统使用说明 <a class="header-anchor" href="#权限系统使用说明" aria-label="Permalink to “权限系统使用说明”">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p>MoFox_Bot的权限系统提供了完整的权限管理功能，支持权限等级和权限节点配置。系统包含以下核心概念：</p><ul><li><strong>Master用户</strong>：拥有最高权限，无视所有权限节点，在配置文件中设置</li><li><strong>权限节点</strong>：细粒度的权限控制单元，由插件自行创建和管理</li><li><strong>权限管理</strong>：统一的权限授权、撤销和查询功能</li></ul><h2 id="配置文件设置" tabindex="-1">配置文件设置 <a class="header-anchor" href="#配置文件设置" aria-label="Permalink to “配置文件设置”">​</a></h2><p>在 <code>config/bot_config.toml</code> 中添加权限配置：</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">permission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 权限系统配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Master用户配置（拥有最高权限，无视所有权限节点）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 格式：[[platform, user_id], ...]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">master_users = [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456789&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># QQ平台的Master用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;987654321&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以配置多个Master用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h2 id="插件开发中使用权限系统" tabindex="-1">插件开发中使用权限系统 <a class="header-anchor" href="#插件开发中使用权限系统" aria-label="Permalink to “插件开发中使用权限系统”">​</a></h2><h3 id="_1-注册权限节点" tabindex="-1">1. 注册权限节点 <a class="header-anchor" href="#_1-注册权限节点" aria-label="Permalink to “1. 注册权限节点”">​</a></h3><p>在插件的 <code>on_load()</code> 方法中注册权限节点：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> src.plugin_system.apis.permission_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyPlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BasePlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> on_load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 注册权限节点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        permission_api.register_permission_node(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;plugin.myplugin.admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 权限节点名称</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;我的插件管理员权限&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 权限描述</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;myplugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 插件名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            False</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        # 默认是否授权（False=默认拒绝）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        permission_api.register_permission_node(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;plugin.myplugin.user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;我的插件用户权限&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;myplugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            True</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 默认授权</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span></code></pre></div><h3 id="_2-使用权限装饰器" tabindex="-1">2. 使用权限装饰器 <a class="header-anchor" href="#_2-使用权限装饰器" aria-label="Permalink to “2. 使用权限装饰器”">​</a></h3><p>最简单的权限检查方式是使用装饰器：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> src.plugin_system.utils.permission_decorators </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> require_permission, require_master</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @require_permission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plugin.myplugin.admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, message: Message, chat_stream: ChatStream, args: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> send_message(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你有管理员权限！&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @require_master</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;只有Master可以执行此操作&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> master_only_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, message: Message, chat_stream: ChatStream):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> send_message(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Master专用功能&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_3-手动权限检查" tabindex="-1">3. 手动权限检查 <a class="header-anchor" href="#_3-手动权限检查" aria-label="Permalink to “3. 手动权限检查”">​</a></h3><p>对于更复杂的权限逻辑，可以手动检查权限：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> src.plugin_system.utils.permission_decorators </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PermissionChecker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseCommand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, message: Message, chat_stream: ChatStream, args: List[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 检查是否为Master用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PermissionChecker.is_master(chat_stream):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> send_message(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Master用户可以执行所有操作&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 检查特定权限</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PermissionChecker.check_permission(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plugin.myplugin.read&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> send_message(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你可以读取数据&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 使用 ensure_permission 自动发送权限不足消息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PermissionChecker.ensure_permission(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plugin.myplugin.write&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> send_message(chat_stream, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你可以写入数据&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_4-直接使用权限api" tabindex="-1">4. 直接使用权限API <a class="header-anchor" href="#_4-直接使用权限api" aria-label="Permalink to “4. 直接使用权限API”">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> src.plugin_system.apis.permission_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查权限</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">has_permission </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.check_permission(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plugin.myplugin.admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查是否为Master</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_master </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.is_master(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 授权用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">success </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.grant_permission(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plugin.myplugin.admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 撤销权限</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">success </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.revoke_permission(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plugin.myplugin.admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取用户的所有权限</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permissions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.get_user_permissions(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;qq&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取所有权限节点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">all_nodes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.get_all_permission_nodes()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取指定插件的权限节点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">plugin_nodes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permission_api.get_plugin_permission_nodes(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myplugin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="权限管理命令" tabindex="-1">权限管理命令 <a class="header-anchor" href="#权限管理命令" aria-label="Permalink to “权限管理命令”">​</a></h2><p>系统提供了内置的权限管理命令，需要相应权限才能使用：</p><h3 id="管理员命令-需要-plugin-permission-manage-权限" tabindex="-1">管理员命令（需要 <code>plugin.permission.manage</code> 权限） <a class="header-anchor" href="#管理员命令-需要-plugin-permission-manage-权限" aria-label="Permalink to “管理员命令（需要 plugin.permission.manage 权限）”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># 授权用户权限</span></span>
<span class="line"><span>/permission grant @用户 plugin.example.admin</span></span>
<span class="line"><span>/permission grant 123456789 plugin.example.admin</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 撤销用户权限</span></span>
<span class="line"><span>/permission revoke @用户 plugin.example.admin</span></span>
<span class="line"><span>/permission revoke 123456789 plugin.example.admin</span></span></code></pre></div><h3 id="查看命令-需要-plugin-permission-view-权限" tabindex="-1">查看命令（需要 <code>plugin.permission.view</code> 权限） <a class="header-anchor" href="#查看命令-需要-plugin-permission-view-权限" aria-label="Permalink to “查看命令（需要 plugin.permission.view 权限）”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># 查看用户权限列表</span></span>
<span class="line"><span>/permission list @用户</span></span>
<span class="line"><span>/permission list 123456789</span></span>
<span class="line"><span>/permission list  # 查看自己的权限</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 检查用户是否拥有权限</span></span>
<span class="line"><span>/permission check @用户 plugin.example.admin</span></span>
<span class="line"><span>/permission check 123456789 plugin.example.admin</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 查看权限节点列表</span></span>
<span class="line"><span>/permission nodes  # 查看所有权限节点</span></span>
<span class="line"><span>/permission nodes example_plugin  # 查看指定插件的权限节点</span></span></code></pre></div><h3 id="帮助命令" tabindex="-1">帮助命令 <a class="header-anchor" href="#帮助命令" aria-label="Permalink to “帮助命令”">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>/permission help  # 显示帮助信息</span></span></code></pre></div><h2 id="权限节点命名规范" tabindex="-1">权限节点命名规范 <a class="header-anchor" href="#权限节点命名规范" aria-label="Permalink to “权限节点命名规范”">​</a></h2><p>建议使用以下命名规范：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>plugin.&lt;插件名&gt;.&lt;功能类别&gt;.&lt;具体权限&gt;</span></span></code></pre></div><p>示例：</p><ul><li><code>plugin.music.play</code> - 音乐插件播放权限</li><li><code>plugin.music.admin</code> - 音乐插件管理权限</li><li><code>plugin.game.user</code> - 游戏插件用户权限</li><li><code>plugin.game.room.create</code> - 游戏插件房间创建权限</li></ul><h2 id="权限系统数据库表" tabindex="-1">权限系统数据库表 <a class="header-anchor" href="#权限系统数据库表" aria-label="Permalink to “权限系统数据库表”">​</a></h2><p>系统会自动创建以下数据库表：</p><ol><li><strong>permission_nodes</strong> - 存储权限节点信息</li><li><strong>user_permissions</strong> - 存储用户权限授权记录</li></ol><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to “最佳实践”">​</a></h2><ol><li><strong>细粒度权限</strong>：为不同功能创建独立的权限节点</li><li><strong>默认权限设置</strong>：谨慎设置默认权限，敏感操作应默认拒绝</li><li><strong>权限描述</strong>：为每个权限节点提供清晰的描述</li><li><strong>Master用户</strong>：只为真正的管理员分配Master权限</li><li><strong>权限检查</strong>：在执行敏感操作前始终检查权限</li></ol><h2 id="示例插件" tabindex="-1">示例插件 <a class="header-anchor" href="#示例插件" aria-label="Permalink to “示例插件”">​</a></h2><p>查看 <code>plugins/permission_example.py</code> 了解完整的权限系统使用示例。</p><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to “故障排除”">​</a></h2><ol><li><strong>权限检查失败</strong>：确保权限节点已正确注册</li><li><strong>Master用户配置</strong>：检查配置文件中的用户ID格式是否正确</li><li><strong>权限不生效</strong>：重启机器人以重新加载配置</li><li><strong>数据库问题</strong>：检查数据库连接和表结构是否正确</li></ol>`,41)),a(n),a(l)])}const m=p(k,[["render",r]]);export{u as __pageData,m as default};
